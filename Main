import java.util.*;
import java.io.*;


public class Main {
    // use this to read in a matrix as long as you know DB name, DB path, number of rows, collumns
    public static String[][] ReadDBnow(String DBpath, int rowno, int colno) throws FileNotFoundException, IOException {

        //DBname eg. <"databaseKey.csv">, DBpath eg. <"C:/Users/sebmu/IdeaProjects/1stday/databaseKey.csv">

        String[][] arrayValues = new String[rowno][colno]; //The returned matrix

        //File file = new File(DBname);

        BufferedReader bufRdr = new BufferedReader(new FileReader(DBpath));
        String line = null;
        int row = 0;
        int col = 0;

        //read each line of text file
        while ((line = bufRdr.readLine()) != null) {
            StringTokenizer st = new StringTokenizer(line, ",");
            while (st.hasMoreTokens()) {
                //get next token and store it in the array
                arrayValues[row][col] = st.nextToken();
                col++;
            }
            col = 0;
            row++;
        }
        //close the file
        bufRdr.close();

        return arrayValues;
    }

    public static String[] All177Species(String[][] BigMatrix){
        String [] Species=new String[BigMatrix[0].length-2];
        for (int x=0;x<BigMatrix[0].length-2;x++){
            Species[x]=BigMatrix[0][x];
        }
        return Species;
    }

    public static int IndexMaxInArray(double[] arrayToFindMax){
        int indMax=0;
        double MAX=arrayToFindMax[0];
        for(int i=0; i<arrayToFindMax.length;i++){
            if (arrayToFindMax[i]>MAX){
                MAX=arrayToFindMax[i];
                indMax=i;
            }
        }
        return indMax;
    }

    public static int IndexMaxInArray(int[] arrayToFindMax){
        int indMax=0;
        int MAX=arrayToFindMax[0];
        for(int i=0; i<arrayToFindMax.length;i++){
            if (arrayToFindMax[i]>MAX){
                MAX=arrayToFindMax[i];
                indMax=i;
            }
        }
        return indMax;
    }


    public static String[] FindCriteriaMatrix(String[][] BigMatrix, int Questionno) {
        String[] CriteriaMatrix = new String[Questionno];

        int c = 0;

        for (int i = 1; i < BigMatrix.length; i++) {
            CriteriaMatrix[c] = BigMatrix[i][0];

            while ((i < (BigMatrix.length - 1)) && (BigMatrix[i][1] != null)) {
                i += 1;
            }
            c += 1;
        }
        return CriteriaMatrix;
    }


    public static String[][] FindSpeciesMatrix(String[][] BigMatrix, int Questionno, int TotalNoOfAnswers) {
        String[][] SpeciesMatrix = new String[Questionno][TotalNoOfAnswers];

        int c = 0;
        int s = 0;

        for (int i = 1; i < BigMatrix.length; i++) {
            while ((i < (BigMatrix.length - 1) && (BigMatrix[i][1] != null))) {
                SpeciesMatrix[c][s] = BigMatrix[i][1];
                s += 1;
                i += 1;
            }
            c += 1;
            s = 0;
        }
        return SpeciesMatrix;
    }

    public static String[][][] FindValuesMatrix(String[][] BigMatrix, int Questionno, int TotalNoOfAnswers) {

        String[][][] ValuesMatrix = new String[Questionno][TotalNoOfAnswers][BigMatrix[0].length-2];

        int c = 0;
        int s = 0;
        for (int i = 1; i < BigMatrix.length; i++) {
            while ((BigMatrix[i][1] != null) && (i < (BigMatrix.length - 1))) {
                for (int x = 2; x < BigMatrix[0].length; x++)
                    ValuesMatrix[c][s][x - 2] = BigMatrix[i][x];
                s += 1;
                i += 1;
            }
            c += 1;
            s = 0;
        }
        return ValuesMatrix;
    }

    public static String[][] resizeArray(String[][] stringThingy){
        for(int i=0;i<stringThingy.length;i++){
            for(int j=0;j<stringThingy[i].length;j++){
                if(stringThingy[i][j]==null){
                    String[] resizedArray= new String[j];
                    for (int k=0;k<j;k++){
                        resizedArray[k]=stringThingy[i][k];
                    }
                    stringThingy[i]=resizedArray;
                    break;
                }
            }
        }
        return stringThingy;
    }

    public static String[][][] reszeArray(String[][][] stringThingy){
        for(int i=0;i<stringThingy.length;i++) {
            for (int j = 0; j < stringThingy[i].length; j++) {


                    if (stringThingy[i][j][0] == null) {
                        String[][] resizedArray = new String[j][stringThingy[i][j].length];
                        for (int h = 0; h < j; h++) {
                            for (int l = 0; l < stringThingy[i][j].length; l++) {
                                resizedArray[h][l] = stringThingy[i][h][l];
                            }
                        }

                        stringThingy[i] = resizedArray;
                        break;

                    }

            }
        }
        return stringThingy;
    }


    public static double[][][] integerArray(String[][][] String3D){
        double[][][] finalArray= new double[String3D.length][String3D[0].length][String3D[0][0].length];
        for(int i=0;i<String3D.length;i++){
            finalArray[i]=new double[String3D[i].length][String3D[0][0].length];
        }
        for(int i=0;i<String3D.length;i++){
            for(int j=0;j<String3D[i].length;j++){
                for(int k=0;k<String3D[i][j].length;k++){
                    finalArray[i][j][k]=Double.parseDouble(String3D[i][j][k]);
                }
            }
        }
        return finalArray;
    }

    public static void printDatabase(String[] CriteriaMatrix,String[][] SpeciesMatrix,double[][][] ValuesMatrix){
        for (int i = 0; i < CriteriaMatrix.length; i++) {
            System.out.println(CriteriaMatrix[i]);
            for (int j = 0; j < SpeciesMatrix[i].length; j++) {
                System.out.println(SpeciesMatrix[i][j]);
                for (int k = 0; k < (ValuesMatrix[i][j].length); k++)
                    System.out.print(ValuesMatrix[i][j][k]);
                System.out.println();
            }
        }

    }

    public static int algorythm(double[][][] ValueMatrix,int[] Pointforspecies,boolean[] AlredyAskedQuest){
        double[] EfficiencyIndex=new double[ValueMatrix[0][0].length];
        for(int i=0;i<ValueMatrix.length;i++) {
            if(!AlredyAskedQuest[i]){
            double index = 0;
            for (int j = 0; j < ValueMatrix[i].length; j++) {
                int noZeros = 0;
                double sumLine = 0;
                for (int k = 0; k < ValueMatrix[i][j].length; k++) {
                    if (ValueMatrix[i][j][k] == 0)
                        noZeros++;
                    else
                        sumLine += ValueMatrix[i][j][k] * Pointforspecies[k] * Pointforspecies[k];

                }
                index += sumLine * noZeros / Pointforspecies.length;
                EfficiencyIndex[i] = index;
            }
        }
        }


        return IndexMaxInArray(EfficiencyIndex);
    }


    public static void main(String[] args) throws FileNotFoundException, IOException {
        int rowno = 143; // Total Rown Number for the DB matrix
        int colno = 179; // Total Collumn Number for the DB matrix
        int QuestionNo = 34;
        int TotalAnswers = 14; //94;//14;

        String[][] DataBase;
        //DataBase = ReadDBnow("Database.csv", rowno, colno);
        DataBase = ReadDBnow("Database2.csv",rowno,colno);
        String[] CriteriaMatrix = FindCriteriaMatrix(DataBase, QuestionNo);
        String[][] SpeciesMatrix = resizeArray(FindSpeciesMatrix(DataBase, QuestionNo, TotalAnswers));
        double[][][] ValuesMatrix = integerArray(reszeArray(FindValuesMatrix(DataBase, QuestionNo, TotalAnswers)));
        String[] AllSpecies= All177Species(DataBase);
        int[] noPoints= new int[AllSpecies.length];
        for(int i=0; i<noPoints.length;i++)
            noPoints[i]=1;
        Scanner scanner=new Scanner(System.in);
        boolean[] alreadyAskedQuest=new boolean[CriteriaMatrix.length];

        int ChoiceQuest=32;

        for(int i=0; i<CriteriaMatrix.length;i++){
            alreadyAskedQuest[ChoiceQuest]=true;
            System.out.println(CriteriaMatrix[ChoiceQuest]+ ":");
            for(int j=0;j<SpeciesMatrix[ChoiceQuest].length;j++){
                System.out.println(j+1+". "+SpeciesMatrix[ChoiceQuest][j]);
            }
            System.out.println("\nWhat category is the plant in ? (put in the number)");
            int Answ=scanner.nextInt();

            for(int j=0;j<noPoints.length;j++){
                if( ValuesMatrix[ChoiceQuest][Answ-1][j]!=0){
                    noPoints[j]++;
                }
            }

            int PossAnsw=IndexMaxInArray(noPoints);
            boolean finnish=true;
            for(int j=0;j<noPoints.length;j++){
                if(j!=PossAnsw && noPoints[PossAnsw]-1<noPoints[j]){
                    finnish=false;
                }
            }
            if(finnish)
                break;

            ChoiceQuest=algorythm(ValuesMatrix,noPoints, alreadyAskedQuest);


        }

        System.out.println("The Species you are looking at is: "+AllSpecies[IndexMaxInArray(noPoints)]);
    }


}
